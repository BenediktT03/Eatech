<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bestellungen - Eatech Admin</title>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#FF6B6B">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Auth Check -->
    <script src="js/auth-check.js"></script>
    
    <!-- Shared Admin Styles -->
    <link rel="stylesheet" href="css/admin-styles.css">
    
    <style>
        /* Orders specific styles */
        .orders-container {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 1.5rem;
            border: 1px solid var(--border-accent);
        }

        /* Order Status Tabs */
        .status-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--border-accent);
            overflow-x: auto;
        }

        .status-tab {
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-weight: 500;
        }

        .status-tab:hover {
            color: var(--primary);
        }

        .status-tab.active {
            color: var(--primary);
        }

        .status-tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--primary);
        }

        .status-tab .badge {
            background: var(--primary);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 10px;
            font-size: 0.8rem;
            margin-left: 0.5rem;
        }

        /* Search and Filters */
        .orders-filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 300px;
            position: relative;
        }

        .search-input {
            width: 100%;
            background: var(--input-bg);
            border: 1px solid var(--border-accent);
            border-radius: 8px;
            padding: 0.75rem 1rem 0.75rem 3rem;
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        .filter-btn {
            background: var(--input-bg);
            border: 1px solid var(--border-accent);
            color: var(--text);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .filter-btn:hover {
            background: var(--primary);
            color: white;
        }

        /* Orders Grid */
        .orders-grid {
            display: grid;
            gap: 1rem;
        }

        /* Order Card */
        .order-card {
            background: var(--input-bg);
            border: 1px solid var(--border-accent);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .order-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .order-card.priority {
            border-left: 4px solid var(--danger);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .order-id {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary);
        }

        .order-time {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .order-customer {
            margin-bottom: 1rem;
        }

        .customer-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .customer-phone {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* Order Items */
        .order-items {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-accent);
        }

        .order-item:last-child {
            border-bottom: none;
        }

        .item-info {
            flex: 1;
        }

        .item-name {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .item-details {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .item-quantity {
            font-weight: 600;
            color: var(--primary);
        }

        /* Order Footer */
        .order-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-accent);
        }

        .order-total {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary);
        }

        .order-actions {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            background: var(--card-bg);
            border: 1px solid var(--border-accent);
            color: var(--text);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .action-btn:hover {
            background: var(--primary);
            color: white;
        }

        .action-btn.success {
            background: var(--success);
            color: white;
        }

        .action-btn.danger {
            background: var(--danger);
            color: white;
        }

        /* Order Details Modal */
        .order-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 2rem;
        }

        .order-modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 15px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-accent);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: var(--input-bg);
        }

        .modal-body {
            padding: 1.5rem;
        }

        /* Live Indicator */
        .live-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(46, 204, 113, 0.2);
            color: var(--success);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-muted);
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .orders-filters {
                flex-direction: column;
            }

            .search-box {
                min-width: auto;
            }

            .status-tabs {
                padding-bottom: 1rem;
            }

            .order-card {
                padding: 1rem;
            }
        }
    </style>
</head>
<body data-theme="noir-excellence">
    <div class="admin-wrapper">
        <!-- Include Sidebar from main admin template -->
        <aside class="admin-sidebar" id="adminSidebar">
            <!-- Same sidebar as admin-dashboard.html -->
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <!-- Header -->
            <header class="admin-header">
                <div class="header-left">
                    <button class="header-btn mobile-menu" onclick="toggleMobileSidebar()">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 class="page-title">Bestellverwaltung</h1>
                    <div class="live-badge">
                        <span class="live-dot"></span>
                        Live-Updates aktiv
                    </div>
                </div>
                
                <div class="header-right">
                    <button class="header-btn" onclick="refreshOrders()">
                        <i class="fas fa-sync"></i>
                        <span>Aktualisieren</span>
                    </button>
                    
                    <button class="header-btn" onclick="exportOrders()">
                        <i class="fas fa-download"></i>
                        <span>Export</span>
                    </button>
                    
                    <button class="header-btn" onclick="printKitchenView()">
                        <i class="fas fa-print"></i>
                        <span>Küchen-Ansicht</span>
                    </button>
                </div>
            </header>

            <!-- Content -->
            <div class="admin-content">
                <div class="orders-container">
                    <!-- Status Tabs -->
                    <div class="status-tabs">
                        <button class="status-tab active" onclick="filterByStatus('all')">
                            Alle <span class="badge" id="countAll">0</span>
                        </button>
                        <button class="status-tab" onclick="filterByStatus('new')">
                            Neu <span class="badge" id="countNew">0</span>
                        </button>
                        <button class="status-tab" onclick="filterByStatus('preparing')">
                            In Zubereitung <span class="badge" id="countPreparing">0</span>
                        </button>
                        <button class="status-tab" onclick="filterByStatus('ready')">
                            Fertig <span class="badge" id="countReady">0</span>
                        </button>
                        <button class="status-tab" onclick="filterByStatus('completed')">
                            Abgeschlossen <span class="badge" id="countCompleted">0</span>
                        </button>
                    </div>

                    <!-- Search and Filters -->
                    <div class="orders-filters">
                        <div class="search-box">
                            <i class="fas fa-search search-icon"></i>
                            <input 
                                type="text" 
                                class="search-input" 
                                placeholder="Suche nach Bestellnummer, Kunde oder Telefon..."
                                onkeyup="searchOrders(this.value)"
                            >
                        </div>
                        
                        <button class="filter-btn" onclick="showDateFilter()">
                            <i class="fas fa-calendar"></i>
                            <span>Datum</span>
                        </button>
                        
                        <button class="filter-btn" onclick="showAmountFilter()">
                            <i class="fas fa-euro-sign"></i>
                            <span>Betrag</span>
                        </button>
                    </div>

                    <!-- Orders Grid -->
                    <div class="orders-grid" id="ordersGrid">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Lade Bestellungen...</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Order Details Modal -->
    <div class="order-modal" id="orderModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Bestelldetails</h3>
                <button class="modal-close" onclick="closeOrderModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Order details will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDFBlgWE81iHnACVwOmaU0jL7FV0l_tRmU",
            authDomain: "eatech-foodtruck.firebaseapp.com",
            databaseURL: "https://eatech-foodtruck-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "eatech-foodtruck",
            storageBucket: "eatech-foodtruck.firebasestorage.app",
            messagingSenderId: "261222802445",
            appId: "1:261222802445:web:edde22580422fbced22144",
            measurementId: "G-N0KHWJG9KP"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Global Variables
        let allOrders = {};
        let currentFilter = 'all';
        let searchQuery = '';

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadTheme();
            loadOrders();
            startRealtimeUpdates();
        });

        // Load Theme
        function loadTheme() {
            const savedTheme = localStorage.getItem('eatechTheme') || 'noir-excellence';
            document.body.setAttribute('data-theme', savedTheme);
        }

        // Load Orders
        async function loadOrders() {
            try {
                const snapshot = await db.ref('orders').once('value');
                allOrders = snapshot.val() || {};
                updateOrderCounts();
                displayOrders();
            } catch (error) {
                console.error('Error loading orders:', error);
                showError('Fehler beim Laden der Bestellungen');
            }
        }

        // Update Order Counts
        function updateOrderCounts() {
            const counts = {
                all: 0,
                new: 0,
                preparing: 0,
                ready: 0,
                completed: 0
            };

            Object.values(allOrders).forEach(order => {
                counts.all++;
                counts[order.status || 'new']++;
            });

            document.getElementById('countAll').textContent = counts.all;
            document.getElementById('countNew').textContent = counts.new;
            document.getElementById('countPreparing').textContent = counts.preparing;
            document.getElementById('countReady').textContent = counts.ready;
            document.getElementById('countCompleted').textContent = counts.completed;
        }

        // Display Orders
        function displayOrders() {
            const grid = document.getElementById('ordersGrid');
            let filteredOrders = Object.entries(allOrders);

            // Apply status filter
            if (currentFilter !== 'all') {
                filteredOrders = filteredOrders.filter(([id, order]) => 
                    order.status === currentFilter
                );
            }

            // Apply search filter
            if (searchQuery) {
                filteredOrders = filteredOrders.filter(([id, order]) => {
                    const searchLower = searchQuery.toLowerCase();
                    return id.toLowerCase().includes(searchLower) ||
                           order.customer?.name?.toLowerCase().includes(searchLower) ||
                           order.customer?.phone?.includes(searchQuery);
                });
            }

            // Sort by creation time (newest first)
            filteredOrders.sort((a, b) => {
                const timeA = new Date(b[1].createdAt || b[1].timestamp || 0);
                const timeB = new Date(a[1].createdAt || a[1].timestamp || 0);
                return timeA - timeB;
            });

            if (filteredOrders.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">📦</div>
                        <h3>Keine Bestellungen gefunden</h3>
                        <p>Es gibt keine Bestellungen mit den ausgewählten Filtern.</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filteredOrders.map(([orderId, order]) => 
                createOrderCard(orderId, order)
            ).join('');
        }

        // Create Order Card
        function createOrderCard(orderId, order) {
            const time = new Date(order.createdAt || order.timestamp);
            const timeStr = time.toLocaleTimeString('de-CH', {
                hour: '2-digit',
                minute: '2-digit'
            });
            const dateStr = time.toLocaleDateString('de-CH');

            const isPriority = order.status === 'ready' || 
                              (new Date() - time) > 15 * 60 * 1000;

            return `
                <div class="order-card ${isPriority ? 'priority' : ''}" onclick="showOrderDetails('${orderId}')">
                    <div class="order-header">
                        <div>
                            <div class="order-id">#${orderId.slice(-6).toUpperCase()}</div>
                            <div class="order-time">${timeStr} - ${dateStr}</div>
                        </div>
                        <span class="order-status ${order.status || 'new'}">
                            ${getStatusText(order.status)}
                        </span>
                    </div>
                    
                    <div class="order-customer">
                        <div class="customer-name">${order.customer?.name || 'Gast'}</div>
                        <div class="customer-phone">${order.customer?.phone || '-'}</div>
                    </div>
                    
                    <div class="order-items">
                        ${createItemsList(order.items)}
                    </div>
                    
                    <div class="order-footer">
                        <div class="order-total">CHF ${(order.pricing?.total || order.total || 0).toFixed(2)}</div>
                        <div class="order-actions">
                            <button class="action-btn" onclick="event.stopPropagation(); updateStatus('${orderId}', 'preparing')">
                                <i class="fas fa-fire"></i>
                                Zubereiten
                            </button>
                            <button class="action-btn success" onclick="event.stopPropagation(); updateStatus('${orderId}', 'ready')">
                                <i class="fas fa-check"></i>
                                Fertig
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Create Items List
        function createItemsList(items) {
            if (!items || items.length === 0) return '<p>Keine Artikel</p>';

            return items.map(item => `
                <div class="order-item">
                    <div class="item-info">
                        <div class="item-name">${item.name}</div>
                        ${item.specialRequest ? `<div class="item-details">📝 ${item.specialRequest}</div>` : ''}
                    </div>
                    <div class="item-quantity">${item.quantity}x</div>
                </div>
            `).join('');
        }

        // Get Status Text
        function getStatusText(status) {
            const statusMap = {
                'new': 'Neu',
                'preparing': 'In Zubereitung',
                'ready': 'Fertig',
                'completed': 'Abgeschlossen'
            };
            return statusMap[status] || status || 'Neu';
        }

        // Filter by Status
        function filterByStatus(status) {
            currentFilter = status;
            
            // Update active tab
            document.querySelectorAll('.status-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            displayOrders();
        }

        // Search Orders
        function searchOrders(query) {
            searchQuery = query;
            displayOrders();
        }

        // Update Status
        async function updateStatus(orderId, newStatus) {
            try {
                await db.ref(`orders/${orderId}/status`).set(newStatus);
                
                // Update local data
                if (allOrders[orderId]) {
                    allOrders[orderId].status = newStatus;
                }
                
                updateOrderCounts();
                displayOrders();
                
                showNotification(`Bestellung ${orderId.slice(-6).toUpperCase()} auf ${getStatusText(newStatus)} gesetzt`);
                
                // Play sound for ready orders
                if (newStatus === 'ready') {
                    playNotificationSound();
                }
            } catch (error) {
                console.error('Error updating status:', error);
                showError('Fehler beim Aktualisieren des Status');
            }
        }

        // Show Order Details
        function showOrderDetails(orderId) {
            const order = allOrders[orderId];
            if (!order) return;

            const modal = document.getElementById('orderModal');
            const modalBody = document.getElementById('modalBody');
            
            const time = new Date(order.createdAt || order.timestamp);
            
            modalBody.innerHTML = `
                <div class="order-details">
                    <div class="detail-section">
                        <h4>Bestellinformationen</h4>
                        <p><strong>Bestellnummer:</strong> #${orderId.slice(-6).toUpperCase()}</p>
                        <p><strong>Zeit:</strong> ${time.toLocaleString('de-CH')}</p>
                        <p><strong>Status:</strong> <span class="order-status ${order.status}">${getStatusText(order.status)}</span></p>
                    </div>
                    
                    <div class="detail-section">
                        <h4>Kunde</h4>
                        <p><strong>Name:</strong> ${order.customer?.name || 'Gast'}</p>
                        <p><strong>Telefon:</strong> ${order.customer?.phone || '-'}</p>
                        <p><strong>E-Mail:</strong> ${order.customer?.email || '-'}</p>
                        <p><strong>WhatsApp:</strong> ${order.customer?.whatsapp ? 'Ja' : 'Nein'}</p>
                    </div>
                    
                    <div class="detail-section">
                        <h4>Bestellte Artikel</h4>
                        ${createDetailedItemsList(order.items)}
                    </div>
                    
                    <div class="detail-section">
                        <h4>Zahlung</h4>
                        <p><strong>Zwischensumme:</strong> CHF ${(order.pricing?.subtotal || 0).toFixed(2)}</p>
                        ${order.pricing?.discount ? `<p><strong>Rabatt:</strong> -CHF ${order.pricing.discountAmount.toFixed(2)} (${order.pricing.discount}%)</p>` : ''}
                        ${order.pricing?.tip ? `<p><strong>Trinkgeld:</strong> CHF ${order.pricing.tip.toFixed(2)}</p>` : ''}
                        <p><strong>Gesamt:</strong> CHF ${(order.pricing?.total || order.total || 0).toFixed(2)}</p>
                        <p><strong>Zahlungsmethode:</strong> ${order.payment?.method === 'card' ? 'Kreditkarte' : 'TWINT'}</p>
                    </div>
                    
                    <div class="detail-actions">
                        <button class="action-btn" onclick="printOrder('${orderId}')">
                            <i class="fas fa-print"></i> Drucken
                        </button>
                        <button class="action-btn success" onclick="markAsCompleted('${orderId}')">
                            <i class="fas fa-check-double"></i> Als abgeschlossen markieren
                        </button>
                        <button class="action-btn danger" onclick="cancelOrder('${orderId}')">
                            <i class="fas fa-times"></i> Stornieren
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
        }

        // Create Detailed Items List
        function createDetailedItemsList(items) {
            if (!items || items.length === 0) return '<p>Keine Artikel</p>';

            return `
                <table style="width: 100%;">
                    <thead>
                        <tr>
                            <th style="text-align: left;">Artikel</th>
                            <th style="text-align: center;">Menge</th>
                            <th style="text-align: right;">Preis</th>
                            <th style="text-align: right;">Gesamt</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${items.map(item => `
                            <tr>
                                <td>
                                    ${item.name}
                                    ${item.specialRequest ? `<br><small style="color: var(--text-muted);">📝 ${item.specialRequest}</small>` : ''}
                                </td>
                                <td style="text-align: center;">${item.quantity}</td>
                                <td style="text-align: right;">CHF ${(item.price || 0).toFixed(2)}</td>
                                <td style="text-align: right;">CHF ${((item.price || 0) * (item.quantity || 1)).toFixed(2)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // Close Order Modal
        function closeOrderModal() {
            document.getElementById('orderModal').classList.remove('active');
        }

        // Start Realtime Updates
        function startRealtimeUpdates() {
            // Listen for new orders
            db.ref('orders').on('child_added', (snapshot) => {
                const orderId = snapshot.key;
                const order = snapshot.val();
                
                if (!allOrders[orderId]) {
                    allOrders[orderId] = order;
                    updateOrderCounts();
                    displayOrders();
                    
                    // Notification for new orders
                    if (order.status === 'new') {
                        showNotification(`Neue Bestellung #${orderId.slice(-6).toUpperCase()}`);
                        playNotificationSound();
                    }
                }
            });

            // Listen for order updates
            db.ref('orders').on('child_changed', (snapshot) => {
                const orderId = snapshot.key;
                const order = snapshot.val();
                
                allOrders[orderId] = order;
                updateOrderCounts();
                displayOrders();
            });

            // Listen for order removals
            db.ref('orders').on('child_removed', (snapshot) => {
                const orderId = snapshot.key;
                delete allOrders[orderId];
                updateOrderCounts();
                displayOrders();
            });
        }

        // Helper Functions
        function refreshOrders() {
            loadOrders();
            showNotification('Bestellungen aktualisiert');
        }

        function exportOrders() {
            // Implement export functionality
            showNotification('Export wird vorbereitet...', 'info');
        }

        function printKitchenView() {
            // Implement kitchen view printing
            window.print();
        }

        function showNotification(message, type = 'success') {
            // Implementation from admin-dashboard
            console.log(`${type}: ${message}`);
        }

        function showError(message) {
            showNotification(message, 'error');
        }

        function playNotificationSound() {
            // Implementation from admin-dashboard
            const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSt+zPTXhjYGHGS56+2eSgwPTqzn77ViFAUWdL');
            audio.volume = 0.3;
            audio.play().catch(e => console.log('Audio play failed:', e));
        }

        // Add missing style
        const style = document.createElement('style');
        style.textContent = `
            .detail-section {
                margin-bottom: 1.5rem;
            }
            
            .detail-section h4 {
                margin-bottom: 0.75rem;
                color: var(--primary);
            }
            
            .detail-section p {
                margin-bottom: 0.5rem;
            }
            
            .detail-actions {
                display: flex;
                gap: 1rem;
                margin-top: 2rem;
                padding-top: 1.5rem;
                border-top: 1px solid var(--border-accent);
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>